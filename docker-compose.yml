services:
    mongo-db:
        image: "mongo:${MONGO_DB_TAG}"
        hostname: "mongo-db"
        environment:
            MONGO_INITDB_ROOT_USERNAME: "root"
            MONGO_INITDB_ROOT_PASSWORD: "${MONGO_DB_ROOT_PASSWORD}"
        restart: "unless-stopped"
        volumes:
            - "./volumes/mongo-db:/data/db"

    timescale:
        image: "timescale/timescaledb-postgis:${TIMESCALE_TAG}"
        hostname: "timescale"
        environment:
            POSTGRES_USER: "orion-ld"
            POSTGRES_PASSWORD: "${TIMESCALE_ORION_LD_PASSWORD}"
            POSTGRES_HOST_AUTH_METHOD: "trust"
        restart: "unless-stopped"
        volumes:
            - "./volumes/timescale:/var/lib/postgresql/data"

    mysql:
        image: "mysql:${MYSQL_TAG}"
        hostname: "mysql"
        environment:
            MYSQL_ROOT_PASSWORD: "${MYSQL_ROOT_PASSWORD}"
        restart: "unless-stopped"
        volumes:
            - "./volumes/mysql:/var/lib/mysql"

    orion-ld:
        image: "fiware/orion-ld:${ORION_LD_TAG}"
        hostname: "orion-ld"
        ports:
            - "${ORION_LD_PORT}:1026"
        environment:
            ORIONLD_EXPERIMENTAL: "TRUE"
            ORIONLD_MONGOCONLY: "TRUE"
            ORIONLD_MONGO_HOST: "mongo-db"
            ORIONLD_MONGO_USER: "root"
            ORIONLD_MONGO_PASSWORD: "${MONGO_DB_ROOT_PASSWORD}"
            ORIONLD_TROE: "TRUE"
            ORIONLD_TROE_HOST: "timescale"
            ORIONLD_TROE_USER: "orion-ld"
            ORIONLD_TROE_PWD: "${TIMESCALE_ORION_LD_PASSWORD}"
        restart: "unless-stopped"
        depends_on:
            - "mongo-db"
            - "timescale"

    mintaka:
        image: "fiware/mintaka:${MINTAKA_TAG}"
        hostname: "mintaka"
        ports:
            - "${MINTAKA_PORT}:8080"
        environment:
            BASEPATH: "/ngsi-ld/v1"
            DATASOURCES_DEFAULT_HOST: "timescale"
            DATASOURCES_DEFAULT_DATABSE: "orion-ld"
            DATASOURCES_DEFAULT_USERNAME: "orion-ld"
            DATASOURCES_DEFAULT_PASSWORD: "${TIMESCALE_ORION_LD_PASSWORD}"
        restart: "unless-stopped"
        depends_on:
            - "timescale"

    keyrock:
        image: "fiware/idm:${KEYROCK_TAG}"
        hostname: "keyrock"
        ports:
            - "${KEYROCK_PORT}:3000"
        environment:
            IDM_DB_HOST: "mysql"
            IDM_DB_USER: "root"
            IDM_DB_PASS: "${MYSQL_ROOT_PASSWORD}"
            IDM_ADMIN_EMAIL: "${KEYROCK_ADMIN_EMAIL}"
            IDM_ADMIN_PASS: "${KEYROCK_ADMIN_PASSWORD}"
            IDM_CORS_ENABLED: true
            IDM_CORS_ORIGIN: "*"
            IDM_CORS_METHODS: "GET"
        restart: "unless-stopped"
        depends_on:
            - "mysql"

    tcd-app:
        image: "tcd-app:${TCD_APP_TAG}"
        hostname: "tcd-app"
        restart: "unless-stopped"

    tcd-api:
        image: "tcd-api:${TCD_API_TAG}"
        hostname: "tcd-api"
        restart: "unless-stopped"
        volumes:
            - "./tcd-api/.env:/home/node/.env"

    tcd-alert:
        image: "tcd-alert:${TCD_ALERT_TAG}"
        hostname: "tcd-alert"
        restart: "unless-stopped"
        volumes:
            - "./tcd-alert/.env:/var/www/html/.env"

    tcd-schedule:
        image: "tcd-schedule:${TCD_SCHEDULE_TAG}"
        hostname: "tcd-schedule"
        restart: "unless-stopped"
        volumes:
            - "./tcd-schedule/.env:/home/node/.env"

    tcd-iot-axione:
        image: "tcd-iot-axione:${TCD_IOT_AXIONE_TAG}"
        hostname: "tcd-iot-axione"
        restart: "unless-stopped"
        volumes:
            - "./tcd-iot-axione/.env:/var/www/html/.env"

    tcd-iot-axione-downlink:
        image: "tcd-iot-axione-downlink:${TCD_IOT_AXIONE_DOWNLINK_TAG}"
        hostname: "tcd-iot-axione-downlink"
        restart: "unless-stopped"
        volumes:
            - "./tcd-iot-axione-downlink/.env:/home/node/.env"

    tcd-thermostat-wot:
        image: "tcd-thermostat-wot:${TCD_THERMOSTAT_WOT_TAG}"
        hostname: "tcd-thermostat-wot"
        restart: "unless-stopped"
        volumes:
            - "./tcd-thermostat-wot/.env:/home/node/.env"

    tcd-waste-container-wot:
        image: "tcd-waste-container-wot:${TCD_WASTE_CONTAINER_WOT_TAG}"
        hostname: "tcd-waste-container-wot"
        restart: "unless-stopped"
        volumes:
            - "./tcd-waste-container-wot/.env:/home/node/.env"

    tcd-flood-monitoring-wot:
        image: "tcd-flood-monitoring-wot:${TCD_FLOOD_MONITORING_WOT_TAG}"
        hostname: "tcd-flood-monitoring-wot"
        restart: "unless-stopped"
        volumes:
            - "./tcd-flood-monitoring-wot/.env:/home/node/.env"

    tcd-streetlight-wot:
        image: "tcd-streetlight-wot:${TCD_STREETLIGHT_WOT_TAG}"
        hostname: "tcd-streetlight-wot"
        restart: "unless-stopped"
        volumes:
            - "./tcd-streetlight-wot/.env:/home/node/.env"
